<!DOCTYPE html>
<html>
  <head>
  <title></title>
  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
	<meta charset="utf-8">


	<!-- iPad/iPhone specific css below, add after your main css >
	<link rel="stylesheet" media="only screen and (max-device-width: 1024px)" href="ipad.css" type="text/css" />		
	<link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="iphone.css" type="text/css" />		
	-->
	<!-- If your application is targeting iOS BEFORE 4.0 you MUST put json2.js from http://www.JSON.org/json2.js into your www directory and include it here -->
    
    <!-- styles !-->
    <link href="css/style.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="css/farbtastic.css" type="text/css" />
    
    <!-- processing and cordova scripts !-->
    <script type="text/javascript" charset="utf-8" src="cordova-1.7.0.js"></script>
    <script src="js/processing.js" type="text/javascript"></script>
    <script src="js/processing-twitter.js" type="text/javascript"></script>

    <!-- save functions !-->
    <script type="text/javascript" src="js/Lawnchair.js"></script>
    <script type="text/javascript" src="js/adaptors/LawnchairAdaptorHelpers.js"></script>
    <script type="text/javascript" src="js/adaptors/DOMStorageAdaptor.js"></script>
    <script type="text/javascript" src="js/adaptors/WebkitSQLiteAdaptor.js"></script>
    <script type="text/javascript" src="js/adaptors/UserDataStorage.js"></script>
    <script type="text/javascript" src="js/adaptors/html5-filesystem.js"></script>
    <script type="text/javascript" src="js/adaptors/CookieAdaptor.js"></script>
    <script type="text/javascript" src="js/adaptors/indexed-db.js"></script> 
    <script type="text/javascript" src="js/adaptors/memory.js"></script>  
    <script type="text/javascript" src="js/adaptors/gears-sqlite.js"></script>      
    <script type="text/javascript" src="js/adaptors/dom.js"></script>      
        
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/farbtastic.js"></script>
        
    <!-- jquery mobile  !-->   
    <script src="js/jquery.mobile-1.2.0.min.js"></script>
        
    <!-- jquery touchswipe !-->
    <script src="js/jquery.touchSwipe-1.2.5.js"></script>
    

    <!-- jquery mobile css !-->
    <link rel="stylesheet"  href="css/themes/default/jquery.mobile-1.2.0.css" />
                                
    <!-- main page functions -->
    <script type="text/javascript">
	// If you want to prevent dragging, uncomment this section
	//*
	function preventBehavior(e) 
	{ 
      e.preventDefault(); 
    };
	document.addEventListener("touchmove", preventBehavior, false);
	//*/
	
	/* If you are supporting your own protocol, the var invokeString will contain any arguments to the app launch.
	see http://iphonedevelopertips.com/cocoa/launching-your-own-application-via-a-custom-url-scheme.html
	for more details -jm */
	/*
	function handleOpenURL(url)
	{
		// TODO: do something with the url passed in.
	}
	*/
	
	function onBodyLoad()
	{
        checkConnection();
		document.addEventListener("deviceready", onDeviceReady, false);
        //// INIT STARTUP CONFIGURATIONS
        var theSelectedButton = document.getElementById("color2");
        // theSelectedButton.className += 'colorwell-selected';
        // theData = new Lawnchair("settings");
        console.log("STARTING APP and INITILIZING DB");
        theData = new Lawnchair({name:'settings'},function(e){
                                console.log('storage open');
                                });
	}
        
    // turn off app when the back key is down
    function onDeviceReady(){
        
        
        checkConnection();
        document.addEventListener("backbutton",onBackKeyDown,true);
    }
        
	/* When this function is called, Cordova has been initialized and is ready to roll */
	

    function checkConnection() {
        console.log("Checking Network connection");
        var networkState = navigator.network.connection.type;
            
        var states = {};
        states[Connection.UNKNOWN]  = 'Unknown connection';
        states[Connection.ETHERNET] = 'Ethernet connection';
        states[Connection.WIFI]     = 'WiFi connection';
        states[Connection.CELL_2G]  = 'Cell 2G connection';
        states[Connection.CELL_3G]  = 'Cell 3G connection';
        states[Connection.CELL_4G]  = 'Cell 4G connection';
        states[Connection.NONE]     = 'No network connection';
            
        // check network status and give an alert if there's no connection
        console.log(states[networkState]);
        if(states[networkState] == 'Unknown connection' || states[networkState] == 'No network connection'){
            navigator.notification.alert(states[networkState] + '. This app requires a network connection in order to function properly. Please check your network settings and restart the application.', null, "CONNECTION STATUS", "Close");
            
        }
    }
    /// interface vars
    var theOverlay; /// help overlay
    var theLoader; // loader object
    var theReadout; // tweet readout object
    var readoutNums; // numbers in the readout
    var topNav; /// top navigation
    
    //// configuration vars
    var configY = 500;
    var theData; // = new Lawnchair('settings'); // save object definition
    // initial vars are null
    var bgColorConfig = "null";
    var fontColorConfig = "null";
    var bgroundPathConfig = "null";
    var animTypeConfig = "null";
    var animSpeedConfig = "null";
    var showPicConfig = "null";
        
        
    /// processing vars
    var processingInstance;
        
        
    // INTERFACE FUNCTIONS /////////////
        
    // called from the canvas
    function showOverlay(theID){
        theOverlay = document.getElementById("interface");
        topNav = document.getElementById("nav-top");
        theOverlay.style.display = "block";
        topNav.style.display = "block";
        
        $("#nav-top").animate({top: '0px'});
        $("#interface").animate({top: '410px'});


    }
    // called from the interface
    function hideOverlay(){
        console.log("SWIPING OVERLAY");
        if (!processingInstance) {
            processingInstance = Processing.getInstanceById('tweets');
        }
        theOverlay = document.getElementById("interface");
        topNav = document.getElementById("nav-top");
        /*
        theOverlay.style.display = "none";
        topNav.style.display = "none";
        */
        /// do animation

        $("#interface").animate({top: '768px'});
        $("#nav-top").animate({top: '-100px'});

        /// toggle the overlay flag so no interface
        /// actions occour when clicking on canvas
        processingInstance.overlayOff();
    }
    
        
    function showLoader(){
        theReadout = document.getElementById("readout-style");
        theReadout.style.display = "none";
        
        theLoader = document.getElementById("loading-style");
        theLoader.style.display = "block";
        //processingInstance.overlayOff();
      
            
    }
    function hideLoader(){
        theLoader = document.getElementById("loading-style");
        theLoader.style.display = "none";
        
        theReadout = document.getElementById("readout-style");
        theReadout.style.display = "block";

    }
    ///// update tweet number readout
        
    function updateTweetReadout(numTweets){
        var readoutNums = document.getElementById("num-tweet-readout");
        readoutNums.value = numTweets;
   
            
    }
    ////////////////////////////////////
    ///////// DEVICE FUNCTIONS ////////

    function onBackKeyDown(){
        console.log("Hit Home Key");
        navigator.device.exitApp();
    }
        
    /// end device functions
    /////////////////////////

    ////////////////////////////////////
    /// PROCESSING CONTROL FUNCTIONS ////

       
    /// speed slider
    function updateSpeed(newValue){
    	/// document.getElementById("range").innerHTML=newValue;
    	processingInstance = Processing.getInstanceById('tweets');
    	processingInstance.changeAnimSpeed(newValue);
        
        animSpeedConfig = newValue;
    }
    /// animation change drop down list
    function changeAnim(animType){
    	processingInstance = Processing.getInstanceById('tweets');
    	processingInstance.changeAnimationType(animType);
    	console.log("ACTIVATING ANIM CHANGE" + animType);
        
        animTypeConfig = animType;
    	
    }
    /// search function
    function changeSearch(){

        var searchBox = document.getElementById("search-box");
        console.log("CHANGE SEARCH: " + searchTerm);
        var searchTerm = searchBox.value;
        processingInstance = Processing.getInstanceById('tweets');
    	processingInstance.initSearch(searchTerm);
      
    }
        /// toggle twitter pic
    function togglePic(toggleValue){
        console.log("TOGGLE PIC:  " + toggleValue);
        processingInstance = Processing.getInstanceById('tweets');
    	processingInstance.togglePic(toggleValue);
        
        showPicConfig = toggleValue;

    }
    ////////////////////////////////////
        
    /// SHOW AND HIDE THE HELP /////////////
    function showHelp(){
        theHelp = document.getElementById("help_panel");
        theHelp.style.display = "block";
            
            
    }
    function hideHelp(){
        theHelp = document.getElementById("help_panel");
        theHelp.style.display = "none";
            
            
    }
        
    ////// SAVE SETTINGS ////////////////
        

        function doSave() {
            // Retrieve the values from the form elements
            // theUsername = document.getElementById('Username').value;
            // thePassword = document.getElementById('Password').value;
            // theAge = document.getElementById('Age').value;
            
            console.log("Saving: " + theData);
            // Construct an object with them - the key value is the primary key for the record.
            var theSettings = {key:"settings",
                BGColor:bgColorConfig,
                FontColor:fontColorConfig,
                BgroundPic:bgroundPathConfig,
                AnimType:animTypeConfig,
                AnimSpeed:animSpeedConfig,
                ShowPic:showPicConfig
            };
            
            // Send them to the data store
            theData.save(theSettings);
            
            // alert("Saved!");
            console.log("Set object value: " + theSettings );
        }
        function deleteSave() {
            theData.remove('settings');
            console.log("Set object value to null.");

            
        }
        function retrieveSave() {
            // Call the get function, giving it the key we used to save with and a return function to populate the form with the values of the object
            theData.get("settings",
                        function(theSettings) {
                        // Test we actually got a settings object
                        if (theSettings) {
                        // We did, so apply the data to the animation
                        bgColorConfig = theSettings.BGColor;
                        fontColorConfig = theSettings.FontColor;
                        bgroundPathConfig = theSettings.BgroundPic;
                        animTypeConfig = theSettings.AnimType;
                        animSpeedConfig = theSettings.AnimSpeed;
                        showPicConfig = theSettings.ShowPic;
                        
                        } else {
                        console.log("No settings found!");
                        }  
                        } // function(theSettings)  
                        );  
            console.log("Recalled!");
            //
            /// save to the processing skech
            processingInstance = Processing.getInstanceById('tweets');
            processingInstance.setBackgroundImage(bgroundPathConfig);
            processingInstance.changeBGColor(bgColorConfig);
            processingInstance.changeFontColor(fontColorConfig);
            processingInstance.changeAnimationType(animTypeConfig);
            processingInstance.changeAnimSpeed(animSpeedConfig);
            
            console.log("UPDATED");
        }
        
        //// END SAVE SETTINGS

     
    //// COLOR CHANGE FUNCTIONS ///////////
    /// change background color
    function changeBackgroundColor(hexColor){
        // console.log("INIT BG COLOR CHANGE:  " + hexColor);
         Processing.getInstanceById('tweets').changeBGColor(hexColor);
        
         bgColorConfig = hexColor;
    
    }
    function changeFontColor(hexColor){
        Processing.getInstanceById('tweets').changeFontColor(hexColor);
        
        fontColorConfig = hexColor;
    }
        
    /// end PROCESSING CONTROL
        
        ////// CAMERA and PICTURE UPLOAD FUNCTIONS /////////////
        var pictureSource;   // picture source
        var destinationType; // sets the format of returned value
        
        // Wait for Cordova to connect with the device
        //
        document.addEventListener("deviceready",onDeviceReady,false);
        
        // Cordova is ready to be used!
        //
        function onDeviceReady() {
            pictureSource=navigator.camera.PictureSourceType;
            destinationType=navigator.camera.DestinationType;
        }
        
        // Called when a photo is successfully retrieved
        //
        function onPhotoDataSuccess(imageData) {
            // Uncomment to view the base64 encoded image data
            // console.log(imageData);
            
            // Get image handle
            //
            var smallImage = document.getElementById('smallImage');
            
            // Unhide image elements
            //
            smallImage.style.display = 'block';
            
            // Show the captured photo
            // The inline CSS rules are used to resize the image
            //
            smallImage.src = "data:image/jpeg;base64," + imageData;
        }
        
        // Called when a photo is successfully retrieved
        //
        function onPhotoURISuccess(imageURI) {
            // Uncomment to view the image file URI
            console.log("SELECTED IMAGE: " + imageURI);
            
            // Get image handle
            //
            /*
             var largeImage = document.getElementById('largeImage');
             
             // show the image in a div tag
             // Unhide image elements
             
             largeImage.style.display = 'block';
             
             // Show the captured photo
             // The inline CSS rules are used to resize the image
             //
             largeImage.src = imageURI;
             
             */
            /// save to the processing skech
            processingInstance = Processing.getInstanceById('tweets');
            processingInstance.setBackgroundImage(imageURI);
            
            bgroundPathConfig = imageURI;
            
        }
        
        // simple capture
        /*
         function capturePhoto() {
         // Take picture using device camera and retrieve image as base64-encoded string
         navigator.camera.getPicture(onPhotoDataSuccess, onFail, { quality: 50,
         destinationType: destinationType.DATA_URL });
         }
         */
        /*
         function capturePhotoEdit() {
         // Take picture using device camera, allow edit, and retrieve image as base64-encoded string
         navigator.camera.getPicture(onPhotoDataSuccess, onFail, { quality: 20, allowEdit: true,
         destinationType: destinationType.DATA_URL });
         }
         */
        // GET PHOTO
        //
        function getPhoto(source) {
            // Retrieve image file location from specified source
            navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 50,
                                        destinationType: destinationType.FILE_URI,
                                        sourceType: source });
        }
        
        // FAIL FUNCTIONS.
        //
        function onFail(message) {
            alert('Failed because: ' + message);
        }
        
        /// DELETE BACKGROUND IMAGE
        function deletePhoto(){
            
            processingInstance = Processing.getInstanceById('tweets');
            processingInstance.deleteBackgroundImage();
            
            
        }
        
        //////// END CAMERA CODE ////////////////
        
                    
    </script>
        
    <!-- COLOR PICKER CODE !-->
        
    <script type="text/javascript" charset="utf-8">
        $(document).ready(function() {
                        $('#color_picker').hide();
                        var f = $.farbtastic('#picker');
                        var p = $('#picker');
                        var selected;
                        $('.colorwell')
                        .each(function () { f.linkTo(this); $(this).css('opacity', 1); })
                        .focus(function() {
                               /// handle button highlights
                                if (selected) {
                                     $(selected).css('opacity', 1).removeClass('colorwell-selected');
                                     }
                                     f.linkTo(this);
                                     p.css('opacity', 1);
                                     $(selected = this).css('opacity', 1).addClass('colorwell-selected');
                                     });
                        });
    </script>

        
  </head>
  <body onLoad="onBodyLoad()">

  <div id="container">
  <!--
  CANVAS PROCESSING FUNCTIONS
   -->
  <script id='sketch' type="application/processing">

      // Global ArrayList of tweets is created in processing-twitter.js
      ArrayList<String> words = new ArrayList();
      
      /// GLOBAL PROPERTIES
      int tWidth = 1024;  /// canvas width
      int tHeight = 760;  /// canvas height
      color bgColor = #121256;
      color tFontColor = #FFFFFF;
	  int tAnimSpeed = 2;
      int fadeSpeed;
      int pauseSpeed;
	  int totalNumTweets;
      
      boolean hasTweets = false;
      
      boolean interfaceShowing = true;
      
      boolean showPic = true;
      
      string searchTerm;
      
      // Dynamic list of Tweet objects
      /// this holds our images
      HashMap uniqueTweets;
      //// text object
      ArrayList<TextSpawn> TextObjectArray;// =  new ArrayList();
      // each objects size is stored in an array
      
      
      // for some reason Processing wants to reset the text sizes
      /// I think I can get rid of this
      int[] TextSizes;
      int[] TextPosY;
      float oldLineHeight;
      float newLineHeight;
      
      int curTextID; /// id for texxt object to be faded

 	/// FONTS
      PFont BasicFont = createFont("Arial", 24, true);
      PFont ItalicFont = createFont("Arial Italic", 18, true);
      PFont SanSerif;
      PFont fontOne;
      PFont fontTwo;

      // IMAGES
      // PImage tweetPic;
      PImage bgroundImage;
      boolean showBGImage = false;
      /// ANIMATION PRESETS
      // scroll
      int tBoxSpace = 400; /// this is the spacing between scrolling tweet objects
      int tweetTextSize = 24;
	  string animationType = "fade"; // "fade", "wipeleft", "wiperight", "random"
	  boolean fadeOutReady = false;
	  int vertScrollHeight; // height of all the vertically scrolling tweets
      int theMargin = 50; // margins from side to side
      int charWidth = 10; // width of the text characters
      
    class Tweet {
      public String id;
      public String profileName;
      public String profileImageUrl;
      public PImage profileImage; // needs to be loaded manually
      public String text;
      public Date time;
    }

    void setup() {
        
      searchTerm = "#coachella";
      // XXX: jbuck: "just subtract 10"
	  size(1024, 760);
        
      colorMode(RGB, 100);
      /// size(window.innerWidth, window.innerHeight-10);
      background(bgColor);
      smooth();

      // Slow things down a bit...
      frameRate(30);

               
       initSearch(searchTerm);
        
    }
      
      void initSearch(string tSearch){
          // zero out everything
          searchTerm = tSearch;
          try{
              hasTweets = false;

              // tweets.clear();
              curTextID = 0;
              // hash map that holds our tweet objects and images
              uniqueTweets = new HashMap();
              // text object array that holds all the text objects
              
              TextObjectArray = new ArrayList();
              // set text sizes, pre-populate the array
              /// I don't think we need this anymore
              TextSizes = new int[100];
              TextPosY = new int[100];
              TextSizes[0] = tweetTextSize;

          } catch (e:Error){
              
              console.log("Can't reset tweets: " + e);
          }
          /// show the loading function
          showLoader();
          
          // Start a live feed loading, results will be available in a global
          // ArrayList called tweets.  loadTweets() is a custom method added
          // by processing-twitter.js
          loadTweets(searchTerm);
          
          // You can also pass geolocation data to limit tweets to a geographic area
          // loadTweets('class', '43.7496,-79.4886,1km'); // York University
          spawnText();

          
      }
      
      /// does the initial spawn
      void spawnText(){
          
          /*
          String[] fontList = PFont.list();
          console.log(fontList);
           */
          int prevBoxH = 0;
          int totalBoxH = 0;
          
          // If we haven't created the text objects, do it now
          if (tweets.size() > 0){
              console.log("spawn text objects: " + tweets.size());
              for (int i = 0; i < tweets.size(); i++) {
			
              Tweet t = (Tweet) tweets.get(i);
              /// get tweet data
              String msg = t.text;
              String usrName = t.profileName;
			  String theDate = t.date;
              String theImagePath = t.profileImageUrl;
              // console.log("Name: " + t.profileName);
              
              // set profile image into tweet object by
              // loading a PImage of the profile pic
              // this may be the canvas taint workaround
              t.profileImage = requestImage(t.profileImageUrl);
              // save tweet object to our hashmap list of unique tweets
              uniqueTweets.put(t.id, t);

              //// ADD TEXT SPAWN
              theTextObject = new TextObject();
              TextSizes[i] = tweetTextSize;

              /// initialize our text object
              theTextObject.initText(msg, usrName, theImagePath, theDate, TextSizes[i], t.id);
              TextObjectArray.add(theTextObject);
              /// space the objects with v spacing + the line height

              theTextObject.theY = ((i*tBoxSpace) + prevBoxH) - tBoxSpace;
              // console.log("PREV BOX HEIGHT = " + prevBoxH);
              prevBoxH = theTextObject.textBoxH;
              totalBoxH += prevBoxH;
              vertScrollHeight = (tweets.size()*tBoxSpace);//  + totalBoxH;
              
                  
              updateTweetReadout(tweets.size());
              // theTextObject.theY = (i * 200)-200; /// start spawning above 0 so there's no gap
          }
          /// get the total height of all the tweets for scrolling positioning
          console.log("TOTAL TWEETS: " + tweets.size() + "TOTAL BOX HEIGHT = " + vertScrollHeight + " JUST SPACING: "  + tweets.size()*tBoxSpace);

          totalNumTweets =  tweets.size();
          tweets.clear(); /// why do we want to clear the tweets after this?
		  hasTweets = true;
          hideLoader();

          }
          
      }

    void draw() {
        background(bgColor);
        // CHECK FOR BG IMAGE
        /// DO THE BGROUND IMAGE
        if(showBGImage){
            
            image(bgroundImage, 0, 0);
        }
        
         // CHECK FOR TWITTER DATA
        // if none, spawn the text object
        if (!hasTweets) {
            spawnText(); 
        }

		doTextObjectAnim();
       
    }

       //// INTERFACE FUNCTIONS
    
    // show or hide interface
      // Rebuild the word list when the user clicks
      
      void mousePressed() {
          // background(0);
          // tweets.clear();
          // words.clear();
          overlayOn();
      }
      void overlayOn(){
          /// show overlay
          window.showOverlay(); /// calls to the interface div in the htmls
          interfaceShowing = true; /// 
      }
      void overlayOff(){
          interfaceShowing = false;
      }
      
      void showLoader(){
          
          window.showLoader();
      }
      void hideLoader(){
          
          window.hideLoader();
      }
      
      /// update tweet readout
      void updateTweetReadout(int numTweets){
          
          
          window.updateTweetReadout(numTweets);
      }
      
      /// change background colors

      void changeBGColor(String theColor){
          if(interfaceShowing){
              string dColor = theColor.substring(1);
              color hi = unhex("FF" + dColor);
              bgColor = hi;
          }
          
      }
      //// BACKGROUND IMAGE FUNCTIONS /////
      void setBackgroundImage(String imagePath){
          console.log("Processing has image: " + imagePath);
          
          String bgPath = imagePath;
          // Load image from the ipad
          try{
              bgroundImage = new PImage;
              bgroundImage = loadImage(bgPath);
              showBGImage = true;
          } catch (Exception e){
              
              console.log("CAN'T LOAD IMAGE: " + e);
          }
          
          
      }
      void deleteBackgroundImage(){
          
          showBGImage = false;
          console.log("DELETE BG IMAGE: " + showBGImage);
          
          
      }

      //// change font color
      void changeFontColor(int theColor){
          if(interfaceShowing){
              string dColor = theColor.substring(1);
              color newColor = unhex("FF" + dColor);
              tFontColor = newColor;
          }
         
      }
	  // change speed
	  void changeAnimSpeed(String newValue){
          if(interfaceShowing){
              int dAnim = int(newValue);
              tAnimSpeed = dAnim;
              /// reset everything and fade out with new speed
              TextObject dTextObj = TextObjectArray.get(curTextID);
              dTextObj.fadeIn = false;
              dTextObj.fadeHold = false;
              dTextObj.fadeOut = true;
            //*/
          }
		}
      
      void togglePic(){
          
          if(showPic){
              
              
              showPic = false;
          } else if(!showPic){
              showPic = true;
              
          }
      }
     
	  //// change animation type
      void changeAnimationType(String animType){
		animationType = animType;
          reSetTextObjectFade();
		// console.log("SWITCH animationType CASE");
	  }

      void doTextObjectAnim(){
        switch(animationType) {
  		case 'fade':
    		setTextObjectFade();
    		break;
  		case 'scroll': 
			setTextObjectScroll();
    		break;
  		case 'wipe': 
    		println("wipe"); 
    		break;
 		 default:
    		break;
		}
      }
	
	///// SET ALL TEXT OBJECT ANIMATION //////
	public void setTextObjectFade(){
 		for (int i = 0; i < TextObjectArray.size(); i++){
            try{
                // update text object
                // if it hasn't faded in and out,
                // init fade in toggle
                TextObject dTextObj = TextObjectArray.get(i);
                if(i == curTextID){
					// console.log("FADING: " + curTextID);

					// init fade
					if(!dTextObj.isFading){
						dTextObj.fadeIn = true;
                        dTextObj.isFading = true;
					}
                	dTextObj.doFade();
				} 
                
            } catch (Exception:e){
                println("Can't find object for fade: " + e);
            }
        }	
	}
      
      /// RESET TEXT OBJECT FADE
      public void reSetTextObjectFade(){
          curTextID = 0;
          console.log("RESET FADE: " + TextObjectArray.size());
          for (int i = 0; i < TextObjectArray.size(); i++){
              
              try{
                  
                  // update text object
                  // if it hasn't faded in and out,
                  // init fade in toggle
                  TextObject dTextObj = TextObjectArray.get(i);
                  dTextObj.isFading = false;
                  dTextObj.fadeIn = false;
                  dTextObj.fadeHold = false;
                  dTextObj.fadeOut = false;
                  
              } catch (Exception:e){
                  println("Can't find object to reset fade: " + e);
              }
          }	
      }


	public void setTextObjectScroll(){
		for (int i = 0; i < TextObjectArray.size(); i++){
            try{
                // update text object position
                TextObject dTextObj = TextObjectArray.get(i);
                dTextObj.doScrollAnim();
                
            } catch (Exception:e){
                println("can't find object for scroll" + e);
            }
        }

	}

	//// END SET ALL TEXT OBJECT ANIM /////
      
    ///// DEVICE FUNCTIONS
      // stop app when hit home
      
      // geolocation filter
      
      /// wifi checker
      
    ///// MESSAGING FUNCTIONS
        
      /// error message
        // on
        // off
      
      // help window
      
      // info window

      
    //// TEXT OBJECT /////////
      // /*
      class TextObject {
          String tweetText = "";
          String tweetName = "";
		  String tweetTime = "";
          // String tweetPicPath = "";
          int numChars;
          int totalCharWidth = 0;

          int tSize= 36; // text size
          // int tSpacing = 60; // single line spacing
          int tId; // id of the tweet
		  int fadeLevel = 0;
          color fadeColor = (0,0,0,fadeLevel);

		  // text box sizes
          int numLines;
          int lineHeight = 60; // height of a single line
          int textBoxW = tWidth - (theMargin*2); /// width of the textbox - the margin on each side
		  int textBoxH; // height of the textbox
          int picWidth = 60; // width of twitter pic
          int picAdjY = 11;

          //// TIMER
		  Timer timer;

          /// positioning
          // private int theX = 0;
          private int theY = 0;
          
		  /// fade states
		  boolean fadeIn = false; /// toggle for initial fade in
		  boolean fadeHold = false;      
		  boolean fadeOut = false;
		  boolean isFading = false;
     
          void initText(String theTweet, String theName, String theImagePath, String theDate, int theSize, int theID){
              tId = theID;
              String rawTweet = theTweet;
              tweetText = rawTweet.replace("\n", "");
              tweetText = trim(tweetText); /// get rid of whitespace
              tweetName = theName;
			  tweetTime = theDate;
              /// set the size
              int tSize= theSize;
              //
              numChars = theTweet.length();
              
              // calculate the total length by adding up
              // the width of all the characters
              for(int l=0; l<numChars; l++){
                  int charw = textWidth(theTweet.charAt(l));
                  totalCharWidth += charw;
                  
              }
              // find out how many lines of text there are
              // by dividing numchars*charwidth by textBoxW
              // numLines = round((totalCharWidth)/textBoxW);
              
              // do it by hand?
              if(totalCharWidth < 300){
                  
                  numLines = 0;
              }
              if(totalCharWidth >= 300 && totalCharWidth < (600)){
                  
                  numLines = 1;
              }
              
              if(totalCharWidth >= (600)){
                  numLines = 2;
                  
              }
              
              textBoxH = 60+((numLines)*60);
             
              // numLines = Math.round((charWidth*numChars)/textBoxW);
              // console.log("NUM LINES: " + numLines);
              // console.log("String: " + theTweet);
              // console.log("lines: " + numLines + " char width: " + totalCharWidth);
              
              
          }

		  /// DO FADE ANIMATION////////
		  public void doFade(){
			/// set position
              // update fade speed
              // map(value, start1, stop1, start2, stop2)
              fadeSpeed = map(tAnimSpeed, 0, 20, 0, 50);
              pauseSpeed = map(fadeSpeed, 0,50, 1000, 10);
              
			 if(fadeIn){ //// fading in
				fadeLevel +=fadeSpeed;
                 // isFading = true;
                 /// if faded all the way in,
                 // turn off fadein and start timer
				if(fadeLevel > 255){
					fadeIn = false;
					fadeHold = true;
					fadeOut = false;
					/// start hold timer
					timer = new Timer(pauseSpeed); // decrease the pause time
                    // console.log("TANIM: " + tAnimSpeed + "Fade speed:" + fadeSpeed + " Pause speed: " + pauseSpeed)
					timer.start();
					// console.log("DONE FADE IN, HOLDING" + fadeHold + " " + tId + " "  + fadeOut);
				}
				

			} 
			if (fadeHold){  /// fadeHold
					/// check hold timer status
					/// if it's run out, start fade out
 					if (timer.isFinished()) {
						fadeIn = false;
						fadeHold = false;
						fadeOut = true;
						// console.log("DONE HOLDING, FADING OUT");
					}
			}
			if (fadeOut){ //// fade out
				fadeLevel -=fadeSpeed;
				if(fadeLevel <=0){
					// console.log("DONE FADING OUT");
					fadeIn = true;
					fadeHold = false;
					fadeOut = false;

					/// check to see if we've faded all of them
					/// then reset the fade id
                    
                    curTextID +=1;
                    // console.log("Cur Tweet: " + curTextID + " total: " + totalNumTweets);
                    if(curTextID >= totalNumTweets){
						// console.log("FADED ALL LOOPS< RESETTING: "  + curTextID + " total: " + totalNumTweets);
						curTextID = 0;
						
					}
					isFading = false;
				}
			}
              
              // do the "from" name
			  //// draw the text box
              fill(tFontColor, fadeLevel);
 			  textAlign(CENTER);
              /// "from" text
              string headerText = tweetName + "   ..." + tweetTime;
              textFont(ItalicFont, tSize);
              text(tweetName + "   ..." + tweetTime, theMargin + picWidth, 300, textBoxW, textBoxH);
              // text(tweetName + "   ..." + tweetTime, 45 + thePadding, 300, textBoxW, textBoxH);
              /// draw the image
              
              
              if(showPic){
                  picWidth = 60;
              
                  try{
                      //half the screen width - half the text box width
                      int picPosX = round(1024/2) - round(textWidth(headerText)/2);
                      object t = uniqueTweets.get(tId); // get(tId);
                      image(t.profileImage, picPosX, 300 - picAdjY);
                  } catch(e:error){
                      console.log("can't find tweet object: ");
                  }
              } else {
                  picWidth = 0;
              }

              
              /// tweet text
			  textFont(BasicFont,tSize);
			  text(tweetText, 45, 300 + lineHeight, textBoxW, textBoxH);
              textWidth(1024);

		  }
          
          /// DO SCROLLING ANIMATION ////
          
          public void doScrollAnim(){
              // check size, alignment, color
              // tSize = xsize;
              textAlign(LEFT); //// left align so we can line up the pic with the person's name
              fill(tFontColor);
			  // text(s, 10, 10, 70, 80);
			  // text(tweetText, theX, theY);
              
              /// only render if it's in the viewable area
              if(theY > -tBoxSpace && theY < 800){

                  if(showPic){
                      picWidth = 60;
                      object t = uniqueTweets.get(tId); // get(tId);
                      // Draw the profile image
                      try{
                          image(t.profileImage, theMargin, theY - picAdjY);
                      } catch(e:error){
                        console.log("can't find tweet object: " + e);
                    }
                  } else {
                      picWidth = 0;
                  }

                  // do the "from" name
                  textFont(ItalicFont, tSize);
                  text(tweetName + "   ..." + tweetTime, theMargin + picWidth, theY, textBoxW, lineHeight);
                  // console.log("HEIGHT: " + tweetName + " " + textBoxH);
                  // set the main tweet text
                  textFont(BasicFont,tSize);
                  text(tweetText, theMargin, theY + lineHeight, textBoxW, textBoxH);
                  
                   // move
                  //// show text box
                  /*
                  fill(60,60,60,60);
                  rect(theMargin, theY, textBoxW, textBoxH);
                   */
              }
              theY += tAnimSpeed;
              if(theY >= vertScrollHeight - tBoxSpace){
                  
                  theY = 0 -(tBoxSpace);
              }
              
          }
          
      }
	 
       // end text object ///////
      
   // TIMER CLASS for ANIMATION ////////
class Timer {
 
  int savedTime; // When Timer started
  int totalTime; // How long Timer should last
  
  Timer(int tempTotalTime) {
    totalTime = tempTotalTime;
  }
  
  // Starting the timer
  void start() {
    // When the timer starts it stores the current time in milliseconds.
	// console.log("STARTING TIMER");
    savedTime = millis(); 
  }
  
  // The function isFinished() returns true if 5,000 ms have passed. 
  // The work of the timer is farmed out to this method.
  boolean isFinished() { 
    // Check how much time has passed
    int passedTime = millis()- savedTime;
    if (passedTime > totalTime) {
      return true;
    } else {
      return false;
    }
   }
   
 }

      
      
  </script>
      <canvas id="tweets">
          <p>Please upgrade your browser to something newer, like <a href="http://chrome.google.com" target="_blank">Google Chrome</a></p>
      </canvas>
      
       <!-- TOP NAV !-->
      <div id="nav-top">
          <ul id="nav-top-list">
             <li id="nav-butt-l"></li>
             <li id="nav-butt"><a href="help.html" data-transition="slide" style="color:#FFFFFF; text-decoration:none; font-weight:normal;">HELP</a></li>
             <li id="nav-butt-mid"></li>
             <li id="nav-butt"><a href="#save_panel" data-rel="popup"  data-transition="pop" style="color:#FFFFFF; text-decoration:none; font-weight:normal;">SETTINGS</a></li>
             <li id="nav-butt-mid"></li>
              <!-- <li id="nav-butt"><a href="#" onClick="retrieveSave(); return false;" style="color:#FFFFFF; text-decoration:none; font-weight:normal;">APPLY SAVED SETTINGS</a></li>
                
              <li id="nav-butt-mid"></li>!-->
             <li id="nav-butt"><a href="#" onClick="hideOverlay(); return false;" style="color:#FFFFFF; text-decoration:none; font-weight:normal;">HIDE</a></li>
             <li id="nav-butt-r"></li>
          </ul>
      </div>
      
      <!-- INTERFACE and CONFIG !  -->
        <div id="interface">
            <!-- HEADER CONTAINER !-->
            <div id="header_container">
                <script>
                    
                    $(function()
                      {
                      //Enable swiping...
                      $("#close-button").swipe( {
                                       //Generic swipe handler for all directions
                                       swipe:function(event, direction, distance, duration, fingerCount) {

                                            if(direction == "down"){
                                             hideOverlay();
                                            }
                                       },
                                       //Default is 75px, set to 0 for demo so any distance triggers swipe
                                       threshold:0
                                       });
                      });
                    
                    
                    </script>
                <ul id="header_list">
                <li style="width:297px"><a href="#"><img src="images/header.png" width="297" height="73"></a>
                </li>
                    <li  style="width:210px"><div id="close-button" style="width:220px; height:59px;"></div></li>

                <li style="margin-right:5px;">
                    <div id="label-style">Search Term:</div>
                    <input type="text" id="search-box" name="twittersearch" size="20" onChange="changeSearch()" data-theme="a" style="width:140px;"/>
                    <!-- activate search !-->
                    
                </li>
                <li><br>
                    <a href="#" data-role="button" onClick="changeSearch(); return false;" data-theme="a" style="width:70px;">GO!</a>
                </li>
                <li>
                    <div id="readout-style">Tweets:
                    <input type="text" id="num-tweet-readout" name="num-tweet-readout" width="5" readonly="true"  value="" data-theme="a" style="width:50px"/>
                    </div>
                    <div id="loading-style"><img src="images/ajax-loader.gif" width="35" height="35"></div>
                </li>
                <!-- 
                <li style=" float:right" id="close-button"><a href="#" onClick="hideOverlay(); return false;"><img align="middle" src="images/butt_close.png" width="140" height="40"></a>
                </li>
                 !-->
                </ul>
                
            </div>
            
            <!-- CONFIG CONTAINER !-->
            <div id="config_container">
            <ul id="config_list">
               <!-- COLOR PICKER CODE !-->   
               <li>

               <div id="color_picker" style="color: red; font-size: 1.4em"></div>
               <form action="">
                   <div id="picker" style="float: left;"></div>
                   <div class="form-item" id="form-item">
                       <div id="label-style">Font Color:</div>
                       <!-- <img src="images/butt_fontocolor.png" width="121" height="23"><br> !-->
                       <input type="text" id="color1" name="color1" class="colorwell" value="#FFFFFF" readonly="true" style="width:170px"/>
                   </div>
                   <br>
                   <div class="form-item" id="form-item">
                        <div id="label-style">Background Color:</div>
                       <!-- <img src="images/butt_bgcolor.png" width="213" height="23" ><br> !-->
                       <input type="text" id="color2" name="color2" class="colorwell" value="#121256" readonly="true" style="width:170px"/>
                   </div>
               </form>

            <!-- load picture code !-->
                   
            <li>
                <div id="label-style">Background Image:</div>
                 <a href="#" data-role="button" onClick="getPhoto(pictureSource.PHOTOLIBRARY); return false;" data-theme="a">Load Image</a>
                <br><br>
                 <a href="#" data-role="button" onClick="deletePhoto(); return false;" data-theme="a">Delete Image</a>
                
            </li>
                   
            <!-- misc config code !-->
            <li style="width:150px;">
            <div id="label-style" style="margin-bottom:10px;">Speed:</div>
                <input type="range" class="speedslider" min="0" max="20" value="10" step="1" onchange="updateSpeed(this.value)"  data-theme="a" style="display : none !important; margin-bottom:10px;"/><br>
            <div id="label-style" style=" margin-bottom:10px;">Animation Type:</div>
                <select id="animation" onchange="changeAnim(this.value)"  data-theme="a">
                    <optgroup selected="selected" label="Animation Type" value="fade">Fade</option>
                        <option value ="fade">Fade</option>
                        <option value ="scroll">Scroll</option>
                        <option value ="wipe" >Wipe</option>
                    </optgroup>
                </select>
            <div id="label-style" style="margin-bottom:10px;">Show Pic:</div>
            <select name="flip-1" id="flip-1" data-role="slider" onchange="togglePic(this.value)" data-theme="a">
                <option value="off" >Off</option>
                <option value="on" selected>On</option>
            </select>
            </li>

            </ul>
            </div>
            <!-- end interface !-->
        </div>
    
      <!-- SAVE SECTION !-->
      <div id="save_panel" data-role="popup" data-position-to="window" data-theme="a" data-overlay-theme="a" style="padding:15px">
          <a href="#" data-rel="back" data-role="button" data-theme="a" data-iconpos="notext" data-icon="delete" class="ui-btn-left">Close</a>
          <h1 align="center">CONFIGURATION SETTINGS</h1>
          <div style="width:300px;">Click "save" to save your font colors, background colors, animation type, and other settings. You can click "Load" to apply them at any time. If you want to delete your saved settings, click "Delete".</div>
          <a href="#" data-role="button" onClick="doSave(); return false;"  data-theme="a">Save</a>
          <a href="#" data-role="button" onClick="retrieveSave(); return false;"  data-theme="a">Load</a>
          <a href="#" data-role="button" onClick="deleteSave(); return false;" data-theme="a">Delete</a>
      </div>
      
     
      
    <!-- end container -->
      </div>
    </body>
</html>
